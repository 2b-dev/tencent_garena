<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>ARENA OF VALOR</title>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
    />
    <!-- Bootstrap core CSS -->
    <link
      href="./node_modules/mdbootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Material Design Bootstrap -->
    <link href="./node_modules/mdbootstrap/css/mdb.min.css" rel="stylesheet" />

    <link
      href="./node_modules/sweetalert2/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
    <link
      href="./node_modules/smartwizard/dist/css/smart_wizard.min.css"
      rel="stylesheet"
    />
    <link
      href="./node_modules/smartwizard/dist/css/smart_wizard_theme_arrows.min.css"
      rel="stylesheet"
    />
    <link
      href="./node_modules/@fancyapps/fancybox/dist/jquery.fancybox.min.css"
      rel="stylesheet"
    />
    <!-- Your custom styles (optional) -->
    <link href="./css/css.css" rel="stylesheet" />
  </head>

  <body class="main-body-option2">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
      <div class="container">
        <a class="navbar-brand" href="home.html">
          <strong>ARENA OF VALOR</strong>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <!--<li class="nav-item">
                  <a class="nav-link" href="news.html">NEWS</a>
                </li>-->
            <li class="nav-item">
              <a class="nav-link" href="activities.html">LEISURE AND RETREAT</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                id="navbarDropdownAgenda"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                >AGENDA</a
              >
              <div
                class="dropdown-menu dropdown-primary"
                aria-labelledby="navbarDropdownAgenda"
              >
                <a class="dropdown-item" href="agenda_d1.html">DAY 1</a>
                <a class="dropdown-item" href="agenda_d2.html">DAY 2</a>
                <a class="dropdown-item" href="agenda_d3.html">DAY 3</a>
                <a class="dropdown-item" href="agenda_d4.html">DAY 4</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                id="navbarDropdownAgenda"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                >ISLAND MAP</a
              >
              <div
                class="dropdown-menu dropdown-primary"
                aria-labelledby="navbarDropdownAgenda"
              >
                <a class="dropdown-item" href="hotel.html"
                  >Phuket Angsana Hotel</a
                >
                <a class="dropdown-item" href="mim.html"
                  >Mysterious Island Map</a
                >
              </div>
            </li>
          </ul>

          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="contactus.html">CONTACT US</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle border border-light rounded px-3"
                id="navbarDropdownpf"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                ><i class="fas fa-user mr-2"></i>PROFILE</a
              >
              <div
                class="dropdown-menu dropdown-primary dropdown-menu-right"
                aria-labelledby="navbarDropdownpf"
              >
                <a class="dropdown-item" href="profile_info.html"
                  >PROFILE INFO</a
                >
                <a class="dropdown-item" onclick="logout()">LOG OUT</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="main mt-5 pt-5">
      <div class="container">
        <!--Section: Post-->
        <section class="mt-4">
          <!--Grid row-->
          <div class="row">
            <!--Grid column-->
            <div class="col-md-12 mb-4">
              <!--Featured Image-->
              <div class="card mb-4 wow fadeIn">
                <div
                  id="carousel-example-1z"
                  class="carousel slide carousel-fade"
                  data-ride="carousel"
                >
                  <!--Indicators-->
                  <ol class="carousel-indicators">
                    <li
                      data-target="#carousel-example-1z"
                      data-slide-to="0"
                      class="active"
                    ></li>
                    <li
                      data-target="#carousel-example-1z"
                      data-slide-to="1"
                    ></li>
                    <li
                      data-target="#carousel-example-1z"
                      data-slide-to="2"
                    ></li>
                    <li
                      data-target="#carousel-example-1z"
                      data-slide-to="3"
                    ></li>
                  </ol>
                  <!--/.Indicators-->
                  <!--Slides-->
                  <div class="carousel-inner" role="listbox" id="slide">
                    <!--
                    <div class="carousel-item active">
                      <img
                        class="d-block w-100"
                        src="./images/step4_card1.png"
                        alt="First slide"
                      />
                    </div>
                    <div class="carousel-item">
                      <img
                        class="d-block w-100"
                        src="./images/step4_card1_2.png"
                        alt="Second slide"
                      />
                    </div>
                    <div class="carousel-item">
                      <img
                        class="d-block w-100"
                        src="./images/step4_card1_3.png"
                        alt="Third slide"
                      />
                    </div>
                    <div class="carousel-item">
                      <img
                        class="d-block w-100"
                        src="./images/step4_card1_4.png"
                        alt="Third slide"
                      />
                    </div>-->
                  </div>
                  <!--/.Slides-->
                  <!--Controls-->
                  <a
                    class="carousel-control-prev"
                    href="#carousel-example-1z"
                    role="button"
                    data-slide="prev"
                  >
                    <span
                      class="carousel-control-prev-icon"
                      aria-hidden="true"
                    ></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a
                    class="carousel-control-next"
                    href="#carousel-example-1z"
                    role="button"
                    data-slide="next"
                  >
                    <span
                      class="carousel-control-next-icon"
                      aria-hidden="true"
                    ></span>
                    <span class="sr-only">Next</span>
                  </a>
                  <!--/.Controls-->
                </div>
              </div>
              <!--/.Featured Image-->
              <div class="row mb-4 d-none">
                <div class="col-6 text-left">
                  <a href="#!" class="btn btn-wood"><i class="fas fa-angle-double-left mr-1"></i>Previous</a>
                </div>
                <div class="col-6 text-right">
                  <a href="#!" class="btn btn-wood">Next <i class="fas fa-angle-double-right ml-1"></i></a>
                </div>
              </div>
              <!--Card-->
              <div class="card mb-4 wow fadeIn">
                <!--Card content-->
                <div class="card-body text-center">
                  <p class="h3 mt-4 mb-2" id="activityName"></p>

                  <p class="text-center" id="pax"></p>
                  <div class="progress" id="progress">
                    <!-- <div
                      class="progress-bar"
                      role="progressbar"
                      style="width: 50%"
                      aria-valuenow="50"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                    -->
                  </div>
                  <p class="text-progress" id="Available"></p>

                  <hr />

                  <div class="row justify-content-center" id="limitation">
                      <!-- 
                      <div class="col-2">
                        <img src="./images/phobia_icon/icon_1.png" class="img-fluid">
                      </div>
                      <div class="col-2">
                        <img src="./images/phobia_icon/icon_2.png" class="img-fluid">
                      </div>
                      <div class="col-2">
                        <img src="./images/phobia_icon/icon_3.png" class="img-fluid">
                      </div>
                      <div class="col-2">
                        <img src="./images/phobia_icon/icon_4.png" class="img-fluid">
                      </div>
                      <div class="col-2">
                        <img src="./images/phobia_icon/icon_5.png" class="img-fluid">
                      </div>
                      <div class="col-2">
                        <img src="./images/phobia_icon/" class="img-fluid">
                      </div>
                      -->
                    </div>
                  <button class="btn btn-wood" id="reserve_button" onclick="reserveActivity()">
                    Reserve Your Slot in This Activity
                  </button>
                </div>
              </div>
              <!--/.Card-->

              <!--Card-->
              <div class="card mb-4 wow fadeIn">
                <!--Card content-->
                <div class="card-body">
                  <p class="h5 my-4">ACTIVITIES ARE NOT RECOMMENDED FOR</p>

                  <blockquote class="blockquote">
                    <ul id="rec_text">
                      
                    </ul>
                  </blockquote>

                  <p class="h5 my-4">PREPARATION</p>

                  <blockquote class="blockquote">
                    <ul id="pre">
                      
                      
                    </ul>
                  </blockquote>

                  <p class="h5 my-4">REQUIREMENT</p>
                  <blockquote class="blockquote">
                    <ul id="req">
                      
                    </ul>
                  </blockquote>
                </div>
              </div>
              <!--/.Card-->

              <!--Card-->
              <div class="card mb-4 wow fadeIn">
                <!--Card content-->
                <div class="card-body text-center">
                  <p class="h5 my-4">AGENDA</p>
                  <div class="">
                    <table
                      class="table table-hover table-bordered table-striped"
                    >
                      <thead
                        style="background-image: url('./images/bg_head_table.png'); background-repeat: no-repeat; background-size: 100% 100%; color: #fff;"
                      >
                        <tr>
                          <th class="text-center" scope="col">Time</th>
                          <th class="text-center" scope="col">Activity</th>
                        </tr>
                      </thead>
                      <tbody id="agenda">
                        
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!--/.Card-->

             
            </div>
            <!--Grid column-->
          </div>
          <!--Grid row-->
        </section>
        <!--Section: Post-->
      </div>
    </main>
    <footer class="page-footer text-center font-small wow fadeIn">
      <!--Copyright-->
      <div class="footer-copyright py-3">
        Â© 2019 Copyright: <a href="home.html"> aov-trip.com </a>
      </div>
      <!--/.Copyright-->
    </footer>
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script
      type="text/javascript"
      src="./node_modules/mdbootstrap/js/jquery-3.3.1.min.js"
    ></script>
    <!-- Bootstrap tooltips -->
    <script
      type="text/javascript"
      src="./node_modules/mdbootstrap/js/popper.min.js"
    ></script>
    <!-- Bootstrap core JavaScript -->
    <script
      type="text/javascript"
      src="./node_modules/mdbootstrap/js/bootstrap.min.js"
    ></script>
    <!-- MDB core JavaScript -->
    <script
      type="text/javascript"
      src="./node_modules/mdbootstrap/js/mdb.min.js"
    ></script>
    <!-- Sweet Alert -->
    <script src="./node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
    <script
      type="text/javascript"
      src="./node_modules/@fancyapps/fancybox/dist/jquery.fancybox.min.js"
    ></script>
    <!-- Initializations -->
    <script type="text/javascript">
      // Animations initialization
      new WOW().init();
    </script>
    <script
      type="text/javascript"
      src="./node_modules/smartwizard/dist/js/jquery.smartWizard.min.js"
    ></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      logout = () => {

        sessionStorage.removeItem('user_payload')

        if(sessionStorage.getItem('user_payload')) {

          return null

        } else {

          window.location = 'index.html'

        }

      }

      checkPayload = () => {

          if(!sessionStorage.getItem('user_payload')) {

            window.location = 'index.html'

        }
      }

      activityLoadData = () => {

        const activityArray = []
        axios.get('http://aov-trip.com/aov_api/api/v1/activitysFetch.php')
          .then(res => {

            activityArray.push(res.data)
            
            var activityName = activityArray[0][sessionStorage.getItem('activity_id')]['name']
            var activityMaxUser = activityArray[0][sessionStorage.getItem('activity_id')]['max_user']
            var activityCurrentUser = activityArray[0][sessionStorage.getItem('activity_id')]['current_user']
            var arrayImage = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['gallery'])
            var arrayDes = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['des'])
            var arrayRec = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['rec'])
            var arrayPretxt = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['pre_txt'])
            var arrayPreicon = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['pre_icon'])
            var arrayReqtxt = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['req_txt'])
            var arrayReqicon = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['req_icon'])
            var arrayAgendaTime = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['agenda_time'])
            var arrayAgendaActivity = JSON.parse(activityArray[0][sessionStorage.getItem('activity_id')]['agenda_activity'])
            
            $('#activityName').text(activityName)
            if(activityMaxUser == 322){
              $('#pax').text('Unlimited')
            }else{
              $('#pax').text('Max ' + activityMaxUser + ' Pax')
            }

            for(i = 0; i < arrayImage.length; i++) {
              

              if(i == 0){
                $('#slide').append(

                  `<div class="carousel-item active">
                        <img
                          class="d-block w-100"
                          src="images/pic_slide/` + arrayImage[i] + `"
                          alt="First slide"
                        />
                      </div>`

                )
              }else{
                $('#slide').append(

                  `<div class="carousel-item ">
                        <img
                          class="d-block w-100"
                          src="images/pic_slide/` + arrayImage[i] + `"
                          alt="First slide"
                        />
                      </div>`

                )
              }

             

            }

            $('#progress').append(

                  `<div
                      class="progress-bar"
                      role="progressbar"
                      style="width:`+ (activityCurrentUser / activityMaxUser) * 100 +`%"
                      aria-valuenow="` + activityCurrentUser +`"
                      aria-valuemin="0"
                      aria-valuemax="` + activityMaxUser + `"
                    ></div>`
            )
            if(activityMaxUser == activityCurrentUser){
              $('#Available').text('SORRY, FULLY BOOKED PLEASE SELECT OPTION ACTIVITY')
              $('#reserve_button').addClass('d-none');
            }else{
              //$('#Available').text((activityMaxUser - activityCurrentUser) + ' Available')
              $('#Available').text('Available')
            }
            
            if(arrayRec !== null) {

              for(i = 0; i < arrayRec.length; i++) {
              $('#rec_text').append(
                `<li>`+ arrayRec[i] +`</li>`
              )

            }

            }

            if(arrayPretxt !== null) {

              for(i = 0; i < arrayPretxt.length; i++) {

              $('#pre').append(
                `<li>`+ arrayPretxt[i] +
                    `<img src="./images/icon_activity/`+ arrayPreicon[i] +`" class="img-activity-icon ml-1">
                  </li>`
              )

            }

            }

            
            for(i = 0; i < arrayAgendaActivity.length; i++) {

              $('#agenda').append(

                `<tr>
                          <td class="text-center">` + arrayAgendaTime[i] +`</td>
                          <td>` + arrayAgendaActivity[i] + `</td>
                  </tr>`
              )

            }

            if(arrayReqtxt !== null) {

              for(i = 0; i < arrayReqtxt.length; i++) {

              $('#req').append(

                `<li>` + arrayReqtxt[i] +`
                        <img src="./images/icon_activity/`+ arrayReqicon[i] +`" class="img-activity-icon ml-1">
                      </li>`

              )

            }

            }

          

          })
          .catch(err => console.log(err))

      }

      limitationPayload = () => {

        const postData = {

          ac_id : sessionStorage.getItem('ac_id')

        }

        console.table(postData)
        const limArr = []
        axios.post('http://aov-trip.com/aov_api/api/v1/limitationFetch.php' , JSON.stringify(postData))
          .then(res => {
            limArr.push(res.data)
            console.log(limArr[0][0]['lm_1'])
            console.table(res.data)
            if(limArr[0][0]['lm_1'] == "1") {
              $('#limitation').append(
                `<div class="col-4 col-md-2 my-2">
                        <img src="./images/phobia_icon/icon_1.png" class="img-fluid">
                      </div>`
              )
            }

            if(limArr[0][0]['lm_2'] == "1") {
              $('#limitation').append(
                `<div class="col-4 col-md-2 my-2">
                        <img src="./images/phobia_icon/icon_2.png" class="img-fluid">
                      </div>`
              )
            }

            if(limArr[0][0]['lm_3'] == "1") {
              $('#limitation').append(
                `<div class="col-4 col-md-2 my-2">
                        <img src="./images/phobia_icon/icon_3.png" class="img-fluid">
                      </div>`
              )
            }

            if(limArr[0][0]['lm_4'] == "1") {
              $('#limitation').append(
                `<div class="col-4 col-md-2 my-2">
                        <img src="./images/phobia_icon/icon_4.png" class="img-fluid">
                      </div>`
              )
            }

            if(limArr[0][0]['lm_5'] == "1") {
              $('#limitation').append(
                `<div class="col-4 col-md-2 my-2">
                        <img src="./images/phobia_icon/icon_5.png" class="img-fluid">
                      </div>`
              )
            }

            if(limArr[0][0]['lm_6'] == "1") {
              $('#limitation').append(
                `<div class="col-4 col-md-2 my-2">
                        <img src="./images/phobia_icon/icon_6.png" class="img-fluid">
                      </div>`
              )
            }

          })
          .catch(err => console.log(err))
      }

      reserveActivity = () => {

        const userArr = []
        
        userArr.push(JSON.parse(sessionStorage.getItem('user_payload')))
        
        const user_id = userArr[0]['id']
        const activity_id = sessionStorage.getItem('ac_id')
      
        
        
        const postData = { user_id : user_id , activity_id : activity_id  }

        $.ajax({
          url : "http://aov-trip.com/aov_api/api/v1/reserveActivity.php",
          type : 'POST',
          dataType : 'JSON',
          data : JSON.stringify(postData),
          crossDomain: true,
          success: function(res) {
            if(res.message == "Updated") {
              Swal.fire("Reserve activity" , "" , "success")
                .then(() => { $('#reserve_button').addClass('d-none')
                  window.location = 'activities.html'
                  
                 })
            }
          }
        })

      }

      checkReserveActivity = () => {

        
        const userArr = []

        userArr.push(JSON.parse(sessionStorage.getItem('user_payload')))

        const user_id = userArr[0]['id']

        const postData = {

          user_id : user_id

        }

        

        axios.post('http://aov-trip.com/aov_api/api/v1/reUserData.php' , JSON.stringify(postData))
          .then(res => {
            sessionStorage.setItem('user_payload_redata' , JSON.stringify(res.data))
          })
          .catch(err => console.log(err))
          
        const re_userArr = []
        re_userArr.push(JSON.parse(sessionStorage.getItem('user_payload_redata')))
        
        const user_activity = re_userArr[0][0]['activity_id']
        if(user_activity !== null) {

          $('#reserve_button').addClass('d-none')

        }
        

      }

      _initData = () => {

      const user_payload = []
      user_payload.push(JSON.parse(sessionStorage.getItem('user_payload')))
      
      const user_id = user_payload[0]['id']
      const postData = {

        user_id : user_id

      }
      

      axios.post('http://aov-trip.com/aov_api/api/v1/reUserData.php' , JSON.stringify(postData))
        .then(res => {

          
          sessionStorage.setItem('user_payload_activity' , JSON.stringify(res.data))

        })
        .catch(err => console.log(err))

      const re_payload = []
      re_payload.push(JSON.parse(sessionStorage.getItem('user_payload_activity')))
      
      if(re_payload[0][0]['activity_id'] == null) {

        Swal.fire("No Activity Selected" , "" , "warning")

      }

    }
      _initData()      
      activityLoadData()
      limitationPayload()
      checkReserveActivity()
            
      checkPayload()
      
    </script>
  </body>
</html>
